<h1>Лабораторная №2</h1>

<h2>Задание</h2>

<h3>Обычная:</h3> 
<ol>
  <li>Написать “плохой” Dockerfile, в котором есть не менее трех “bad practices” по написанию докерфайлов</li>
  <li>Написать “хороший” Dockerfile, в котором эти плохие практики исправлены</li>
  <li>В Readme описать каждую из плохих практик в плохом докерфайле, почему она плохая и как в хорошем она была исправлена, как исправление повлияло на результат</li>
  <li>В Readme описать 2 плохих практики по работе с контейнерами. ! Не по написанию докерфайлов, а о том, как даже используя хороший докерфайл можно накосячить именно в работе с контейнерами</li>
</ol>

<h2>Ход работы</h2>

В качестве оборачиваемого процесса была выбрана страница сайта, которую можно просмотреть на порту 8080. Для этого создан Dockerfile, страница html и изображение, которое отображается на вебсстранице. Рассмотрим практики, которые были использованы в Dockerfile.

<h3>1. Использование версий</h3>
Плохая практика: <code>FROM python:latest</code><br/>
Хорошая практика: <code>FROM python:3.8.10</code><br/>
<h5>Почему:</h5> Указание последней неопределенной версии может вызвать проблемы при запуске контейнера через некоторое время. Например, в нашем случае может выйти такое обновление Python, которое больше не будет поддерживать используемые нами функции. Однако стоит отметить, что указание старых версий также не самая лучшая практика, ведь они могут больше не поддерживаться.

<h3>2. Использование RUN</h3>
Плохая практика: </br>
<code>RUN apt-get update</code><br/>
<code>RUN pip3 install numpy</code><br/>
Хорошая практика: <br/>
<code>RUN apt-get update && pip install numpy</code><br/>
<h5>Почему:</h5> Каждый RUN создает новый слой в образе, что значительно увеличивает размер файла. Также при изменении одной из команд особенности кэширования в Docker вызовут перекэширование всех последующих слоев. Именно так использование одной команлы с && позволит улучшить производительность при сборке контейнера.

<h3>3. Указание WORKDIR</h3>
Плохая практика: <code>WORKDIR отсутствует в коде</code><br/>
Хорошая практика: <code>WORKDIR /home/cloudtech/lab2/good-practice</code><br/>
<h5>Почему:</h5> Инструкция WORKDIR позволяет задавать рабочую директорию для следующих команд. Конечно, в нашем случае таких команд не много, но если представить, что рабочая директория имеет длинный путь, а команд, использующих ее очень много, то это значительно увеличивает количество символов в файле и затрудняет его понимание.

<h3>4. Использование COPY вместо ADD</h3>
Плохая практика: <code>ADD ./secret-page .</code><br/>
Хорошая практика: <code>COPY ./secret-page .</code><br/>
<h5>Почему:</h5> Инструкция COPY копирует указанную папку во внутреннюю папку образа. Инструкция ADD также добавляет папку во внутренний образ, но при использовании может извлечь данные из архива или скачать файл из Интернета, если такие употребляются в образе, что не очень приятно при запуске образа.

<h3>5. Команда ENTRYPOINT</h3>
Плохая практика: </br>
<code>CMD ["python3", "-m", "http.server", "8080"]</code><br/>
Хорошая практика: <br/>
<code>ENTRYPOINT ["python3", "-m", "http.server"]</code><br/>
<code>CMD ["8080"]</code><br/>
<h5>Почему:</h5> ENTRYPOINT — это команда, которая задает аргументы для вызова во время выполнения контейнера. При этом ее аргументы не переопределяются. Соответственно, такой вариант организации Dockerfile также облегчает сборку контейнера и не запускает переопределение команды при изменениях в команде CMD, которая отображает результат.

<h3>Вернемся к заданию</h3>
Файл с плохими практиками был сохранен в bad-practice. Далее контейнер был собран и запущен. 
<center><img width="1300" alt="bad-practice" src="https://github.com/user-attachments/assets/a756ae10-0695-428c-8b72-497d43316b4a"></center>
После этого при переходе на localhost:8080 открывалась страница из образа
<center><img width="915" alt="bad-practice-result" src="https://github.com/user-attachments/assets/3ad4dd76-5f38-49fc-b127-5da6ae792acf"></center>
Аналогично собран контейнер с хорошими практиками good-practice
<img width="1300" alt="good-practice" src="https://github.com/user-attachments/assets/a896733f-d80a-4ffc-9847-4a9d0de274a2">
При запуске также открываласт страница, но уже измененная
<img width="900" alt="good-practice-result" src="https://github.com/user-attachments/assets/5e14d4e3-91aa-47f9-b080-17f45f806881">

<h3>Также рассмотрим плохие практики по работе с контейнерами</h3>

Одной из таких практик является запуск контейнера без ограничений ресурсов. Например, на одном хосте будет запущено несколько контейнеров, один из которых будет очень многоресурсным. Это может повлечь некорректную работу других контейнеров и приложений, запущенных с данным.

Еще одна плохая практика — использовать контенер для запуски нескольких процессов. В таком случае могут возникнуть проблемы при отслеживании и управлениями этими самыми процессами, например, при появлении ошибки в одном из них. Также ели потребуется остав=новить один из процессов контенера, значит необходимо будет прервать и остальные.
